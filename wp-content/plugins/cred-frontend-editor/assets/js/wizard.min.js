!function(e,t,n,i){function a(e){e.preventDefault();var i=t(this),r=t("#post_ID").val();return n.doCheck()&&t.ajax({url:n.route(m),data:"form_id="+r+"&field=wizard"+"&value="+s.completed_step,type:"post",success:function(){return i.unbind("submit",a),i.submit(),!0}}),!1}function r(e){var i,a,r=n.getContents();for(i=t(e).serializeArray(),a=0;a<i.length;++a)r[i[a].name]&&(i[a].value=r[i[a].name]);return t.param(i)}function o(e){"disabled"==e.attr("disabled")?e.hasClass("button-primary")&&e.removeClass("button-primary").addClass("button-secondary"):e.hasClass("button-secondary")&&e.removeClass("button-secondary").addClass("button-primary")}var s,l,c,d,u,h,p,f=n.settings.editurl,m=n.settings.form_controller_url,g=n.settings.wizard_url;s={hasSidebar:!1,step:1,prevstep:0,completed_step:0,steps:[{title:n.settings.locale.step_1_title,completed:!1,execute:function(){if(t("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide(),t("#titlediv").show(),d.hide(),s.steps[s.step-1].completed)s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c);else{c.attr("disabled","disabled"),o(c),p.css("width","20%");var e=setInterval(function(){if(s.steps[s.step-1].completed)clearInterval(e);else{var n=t("#title"),i=t.trim(n.val());""!=i&&(clearInterval(e),s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c))}},500)}}},{title:n.settings.locale.step_2_title,completed:!1,execute:function(){if(t("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide(),t("#credformtypediv").removeClass("closed").show(),d.show(),s.steps[s.step-1].completed)s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c);else{c.attr("disabled","disabled"),o(c),p.css("width","40%");var e=setInterval(function(){if(s.steps[s.step-1].completed)clearInterval(e);else{var n=t('select[name="_cred[form][type]"]'),i=t.trim(n.val());""!=i&&(clearInterval(e),s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c))}},500)}}},{title:n.settings.locale.step_3_title,completed:!1,execute:function(){if(t("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide(),t("#credposttypediv").removeClass("closed").show(),d.show(),s.steps[s.step-1].completed)s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c);else{c.attr("disabled","disabled"),o(c),p.css("width","60%");var e=setInterval(function(){if(s.steps[s.step-1].completed)clearInterval(e);else{var n=t('select[name="_cred[post][post_type]"]'),i=t.trim(n.val());""!=i&&(clearInterval(e),s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c))}},500)}}},{title:n.settings.locale.step_4_title,completed:!1,execute:function(){if(t("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide(),t("#credformcontentdiv").removeClass("closed").show(),d.show(),s.steps[s.step-1].completed)s.steps[s.step-1].completed=!0,s.completed_step=s.step,c.removeAttr("disabled"),o(c);else{c.attr("disabled","disabled"),o(c),p.css("width","80%");var e=setInterval(function(){if(s.steps[s.step-1].completed)clearInterval(e);else{var i=n.getContents(),a=t.trim(i.content);""!=a&&(clearInterval(e),s.completed_step=s.step,s.steps[s.step-1].completed=!0,c.removeAttr("disabled"),o(c))}},500)}}},{title:n.settings.locale.step_5_title,completed:!1,execute:function(){t("#postbox-container-2 #normal-sortables, #post-body-content").children(":not(.cred-not-hide)").hide(),t("#crednotificationdiv").removeClass("closed").show(),d.show(),c.removeAttr("disabled"),o(c),s.completed_step=s.step,s.steps[s.step-1].completed=!0}}],prevStep:function(){s.goToStep(s.step-1)},nextStep:function(){if(l&&1==s.step&&!s.steps[1].completed){var e=t("#post_ID").val();n.doCheck()&&t.ajax({url:f,data:r("#post"),type:"post",success:function(){t.ajax({url:n.route(m),data:"form_id="+e+"&field=wizard"+"&value="+s.completed_step,type:"post",success:function(){document.location=f+"?action=edit&post="+e}})}})}else if(n.doCheck()){var i=s.completed_step;s.completed_step==s.steps.length&&(i=-1),t.ajax({url:document.location,data:r("#post")+"&_cred[wizard]="+i,type:"post",success:function(){}}),s.goToStep(s.step+1)}},goToStep:function(e){return i!==e&&(e=parseInt(e,10),e<=s.steps.length+1&&e>=1)?(s.step=e,s.step==s.steps.length+1?(s.finish(),void 0):s.steps[s.step-1]&&t.isFunction(s.steps[s.step-1].execute)?(s.step==s.steps.length?c.val(n.settings.locale.finish_text).show():c.val(n.settings.locale.next_text).show(),s.steps[s.step-1].execute(),n.app.dispatch("cred.wizardChangedStep"),void 0):void 0):void 0},start:function(){t("#postbox-container-2").append('<div class="cred-not-hide cred-wizard-buttons"> <input id="cred_wizard_quit_button" type="button" class="button" value="'+n.settings.locale.quit_wizard_text+'" /> <input type="button" id="cred-wizard-button-prev" class="button" value="'+n.settings.locale.prev_text+'" /> <input type="button" id="cred-wizard-button-next" class="button-primary" value="'+n.settings.locale.next_text+'" /></div>'),t("#post-body-content").prepend('<div class="cred-not-hide cred-progress"><div id="cred-progress-bar"><div id="cred-progress-bar-inner"></div></div></div>'),t("#post-body").hasClass("columns-2")&&(s.hasSidebar=!0,t("#postbox-container-1").hide(),t("#post-body").removeClass("columns-2").addClass("columns-1")),t("#cred-submit, #cred_add_forms_to_site_help").hide(),t("#post").bind("submit",a),c=t("#cred-wizard-button-next"),d=t("#cred-wizard-button-prev"),u=t("#cred_wizard_quit_button"),h=t("#cred-progress-bar"),p=t("#cred-progress-bar-inner");for(var e=0,i=s.steps.length;i>e;e++){var r=t('<span class="cred-progress-step">'+s.steps[e].title+"</span>");r.insertBefore(h).css({left:Math.floor(100*(e+1)/i)+"%","margin-left":-r.width()+"px"})}t("#post").on("click","#cred_wizard_quit_button",function(){form_id=t("#post_ID").val(),n.gui.Popups.confirm({"class":"cred-dialog",message:n.settings.locale.quit_wizard_confirm_text,buttons:[n.settings.locale.quit_wizard_this_form,n.settings.locale.quit_wizard_all_forms,n.settings.locale.cancel_text],callback:function(e){e==n.settings.locale.quit_wizard_all_forms&&t.ajax({url:n.route(g),type:"POST",data:"cred_wizard=false",dataType:"html",success:function(){}}),e==n.settings.locale.quit_wizard_this_form&&t.ajax({url:n.route(m),data:"form_id="+form_id+"&field=wizard"+"&value=-1",type:"post",success:function(){}}),(e==n.settings.locale.quit_wizard_all_forms||e==n.settings.locale.quit_wizard_this_form)&&(t("#post").unbind("submit",a),s.finish())}})}),t("#post").on("click","#cred-wizard-button-next",function(){s.nextStep()}),t("#post").on("click","#cred-wizard-button-prev",function(){s.prevStep()});for(var e=1;e<=s.step;e++)s.steps[e-1]&&(s.steps[e-1].completed=!0);s.completed_step=s.step,p.css("width",100*s.step/s.steps.length+"%"),s.step<s.steps.length&&s.goToStep(s.step+1)},finish:function(){s.completed_step=-1,t("#post").find(".cred-not-hide").remove(),s.hasSidebar&&(t("#post-body").removeClass("columns-1").addClass("columns-2"),t("#postbox-container-1").show(),s.hasSidebar=!1),t("#postbox-container-2 #normal-sortables, #post-body-content").children().show(),t("#cred-submit, #cred_add_forms_to_site_help, .cred_related").show(),t("#credformcontentdiv").hasClass("closed")&&t("h3.hndle","#credformcontentdiv").triggerHandler("click"),n.app.dispatch("cred.wizardFinished")},init:function(e,t){l=t,e>=0&&(s.step=e,s.start())}},e.cred_wizard=s}(window,jQuery,cred_cred);